// Backbone.ModelBinding v0.3.0
//
// Copyright (C)2011 Derick Bailey, Muted Solutions, LLC
// Distributed Under MIT Liscene
//
// Documentation and Full Licence Availabe at:
// http://github.com/derickbailey/backbone.modelbinding
Backbone.ModelBinding=function(){return{version:"0.3.0",bind:function(b,a){Backbone.ModelBinding.Configuration.configureBindingAttributes(a);var c=b.model,d=Backbone.ModelBinding.Conventions,g;for(g in d)if(d.hasOwnProperty(g)){var e=d[g];e.handler.bind(e.selector,b,c)}Backbone.ModelBinding.Configuration.restoreConfiguration()},unbind:function(b){var a=b.model,c=Backbone.ModelBinding.Conventions,d;for(d in c)if(c.hasOwnProperty(d)){var g=c[d],e=g.handler,g=g.selector;e.unbind&&e.unbind(g,b,a)}}}}();
Backbone.ModelBinding.Configuration=function(){var b={text:"id",textarea:"id",password:"id",radio:"name",checkbox:"id",select:"id"};return{configureBindingAttributes:function(a){a&&(this.storeConfiguration(),a.all&&(this.configureAllBindingAttributes(a.all),delete a.all),_.extend(b,a))},configureAllBindingAttributes:function(a){this.storeConfiguration();b.text=a;b.texarea=a;b.password=a;b.radio=a;b.checkbox=a;b.select=a},storeConfiguration:function(){Backbone.ModelBinding._config=_.clone(b)},restoreConfiguration:function(){if(Backbone.ModelBinding._config)b=
Backbone.ModelBinding._config,delete Backbone.ModelBinding._config},getBindingAttr:function(a){return b[a]},getBindingValue:function(a,c){var b=this.getBindingAttr(c);return a.attr(b)}}}();
Backbone.ModelBinding.StandardBinding=function(){var b={_getElementType:function(a){var c=a[0].tagName.toLowerCase();c=="input"&&(c=a.attr("type"));return c},_modelChange:function(a,c){this.element.val(c)}};b.unbind=function(a,c,d){c.$(a).each(function(){var a=c.$(this),a=Backbone.ModelBinding.Configuration.getBindingValue(a,b._getElementType(a));d.unbind("change:"+a,b._modelChange)})};b.bind=function(a,c,d){c.$(a).each(function(){var a=c.$(this),e=Backbone.ModelBinding.Configuration.getBindingValue(a,
b._getElementType(a));d.bind("change:"+e,b._modelChange,{element:a});a.bind("change",function(a){var b={};b[e]=c.$(a.target).val();d.set(b)});var f=d.get(e);typeof f!=="undefined"&&f!==null&&a.val(f)})};return b}();
Backbone.ModelBinding.SelectBoxBinding=function(){var b={_modelChange:function(a,c){this.element.val(c)}};b.unbind=function(a,c,d){c.$(a).each(function(){var a=c.$(this),a=Backbone.ModelBinding.Configuration.getBindingValue(a,"select");d.unbind("change:"+a,b._modelChange)})};b.bind=function(a,c,d){c.$(a).each(function(){var a=c.$(this),e=Backbone.ModelBinding.Configuration.getBindingValue(a,"select");d.bind("change:"+e,b._modelChange,{element:a});a.bind("change",function(a){var b={},a=c.$(a.target);
b[e]=a.val();b[e+"_text"]=a.find(":selected").text();d.set(b)});var f=d.get(e);typeof f!=="undefined"&&f!==null&&a.val(f)})};return b}();
Backbone.ModelBinding.RadioGroupBinding=function(){var b={_modelChange:function(a,b){this.view.$("input[type=radio]["+this.bindingAttr+"="+this.group_name+"][value="+b+"]").attr("checked","checked")}};b.unbind=function(a,c,d){var g=[];c.$(a).each(function(){var a=c.$(this),a=Backbone.ModelBinding.Configuration.getBindingValue(a,"radio");g[a]||(g[a]=!0,Backbone.ModelBinding.Configuration.getBindingAttr("radio"),d.unbind("change:"+a,b._modelChange))})};b.bind=function(a,c,d){var g=[];c.$(a).each(function(){var a=
c.$(this),f=Backbone.ModelBinding.Configuration.getBindingValue(a,"radio");if(!g[f]){g[f]=!0;a=Backbone.ModelBinding.Configuration.getBindingAttr("radio");d.bind("change:"+f,b._modelChange,{bindingAttr:a,group_name:f,view:c});c.$("input[type=radio]["+a+"="+f+"]").bind("change",function(a){a=c.$(a.currentTarget);if(a.attr("checked")){var b={};b[f]=a.val();d.set(b)}});var h=d.get(f);typeof h!=="undefined"&&h!==null&&c.$("input[type=radio]["+a+"="+f+"][value="+h+"]").attr("checked","checked")}})};return b}();
Backbone.ModelBinding.CheckboxBinding=function(){var b={_modelChange:function(a,b){b?this.element.attr("checked","checked"):this.element.removeAttr("checked")}};b.unbind=function(a,c,d){c.$(a).each(function(){var a=c.$(this),a=Backbone.ModelBinding.Configuration.getBindingValue(a,"checkbox");d.unbind("change:"+a,b._modelChange)})};b.bind=function(a,c,d){c.$(a).each(function(){var a=c.$(this),e=Backbone.ModelBinding.Configuration.getBindingValue(a,"checkbox");d.bind("change:"+e,b._modelChange,{element:a});
a.bind("change",function(a){var b={},a=c.$(a.target).attr("checked")?!0:!1;b[e]=a;d.set(b)});if(d.attributes.hasOwnProperty(e)){var f=d.get(e);typeof f!=="undefined"&&f!==null?a.attr("checked","checked"):a.removeAttr("checked")}})};return b}();
Backbone.ModelBinding.DataBindBinding=function(){var b={};b._modelChange=function(a,c){b._setOnElement(this.element,this.elementAttr,c)};b._setOnElement=function(a,b,d){switch(b){case "html":a.html(d);break;case "text":a.text(d);break;case "enabled":a.attr("disabled",!d);break;default:a.attr(b,d)}};b._splitBindingAttr=function(a){a=a.attr("data-bind").split(" ");return{elementAttr:a[0],modelAttr:a[1]}};b.bind=function(a,c,d){c.$(a).each(function(){var a=c.$(this),e=b._splitBindingAttr(a);d.bind("change:"+
e.modelAttr,b._modelChange,{element:a,elementAttr:e.elementAttr});b._setOnElement(a,e.elementAttr,d.get(e.modelAttr))})};b.unbind=function(a,c,d){c.$(a).each(function(){var a=c.$(this),a=b._splitBindingAttr(a);d.unbind("change:"+a.modelAttr,b._modelChange)})};return b}();
Backbone.ModelBinding.Conventions=function(){return{text:{selector:"input:text",handler:Backbone.ModelBinding.StandardBinding},textarea:{selector:"textarea",handler:Backbone.ModelBinding.StandardBinding},password:{selector:"input:password",handler:Backbone.ModelBinding.StandardBinding},radio:{selector:"input:radio",handler:Backbone.ModelBinding.RadioGroupBinding},checkbox:{selector:"input:checkbox",handler:Backbone.ModelBinding.CheckboxBinding},select:{selector:"select",handler:Backbone.ModelBinding.SelectBoxBinding},
databind:{selector:"*[data-bind]",handler:Backbone.ModelBinding.DataBindBinding}}}();
